document.addEventListener("DOMContentLoaded",()=>{!function(){const e=document.querySelectorAll('#order-form input[name="selected_quantity"]'),t=document.querySelectorAll('#order-form label[for^="quantity-"]'),n=document.getElementById("dynamic-price"),i=document.getElementById("original-price"),c=document.getElementById("form-selected-gift");if(!(e.length&&n&&i&&c))return;const a=215e4,s=3e6,o={1:{gift:"Không có",price:a,originalPrice:s},2:{gift:"Tặng 1 hộp bóng Leopard Space X (120k)",price:43e5,originalPrice:6e6},3:{gift:"Tặng 1 áo Leopard (250k)",price:645e4,originalPrice:9e6}},r=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e).replace(/\s/g,"").replace("₫"," VNĐ"),l=e=>{const a=o[e];a&&(n.textContent=r(a.price),i.textContent=r(a.originalPrice),c.value=a.gift),t.forEach(t=>{t.classList.toggle("active",t.htmlFor===`quantity-${e}`)})};e.forEach(e=>{e.addEventListener("change",e=>{l(e.target.value)})}),l("1")}(),function(){const e=document.getElementById("koc-track");if(!e)return;const t=e.parentElement,n=Array.from(e.children),i=document.getElementById("koc-dots"),c=()=>matchMedia("(max-width:767px)").matches;n.forEach((e,t)=>{const n=document.createElement("span");n.className="dot",n.onclick=e=>{e.stopPropagation(),l(t,!0)},i.appendChild(n)});const a=Array.from(i.children);let s=0;function o(e){const i=n[e];if(!i)return;const a=c()?"top":"left",s=c()?"clientHeight":"clientWidth",o=c()?i.offsetTop:i.offsetLeft;t.scrollTo({[a]:o-(t[s]/2-i[s]/2),behavior:"smooth"})}function r(e){n.forEach((t,n)=>{t.toggleAttribute("active",n===e),n===e?t.classList.add("index-top"):t.classList.remove("index-top")}),a.forEach((t,n)=>t.classList.toggle("active",n===e))}function l(e,t){e<0||e>=n.length||e!==s&&(s=e,r(e),t&&o(e))}function d(e){l(Math.min(Math.max(s+e,0),n.length-1),!0)}addEventListener("keydown",e=>{document.activeElement.closest("#koc-review-slider")&&(["ArrowRight","ArrowDown"].includes(e.key)&&d(1),["ArrowLeft","ArrowUp"].includes(e.key)&&d(-1))},{passive:!0}),n.forEach((e,t)=>{e.addEventListener("mouseenter",()=>matchMedia("(hover:hover)").matches&&l(t,!0)),e.addEventListener("click",e=>{e.target.closest(".koc-modal-trigger")||l(t,!0)})});let m=0,u=0;e.addEventListener("touchstart",e=>{m=e.touches[0].clientX,u=e.touches[0].clientY},{passive:!0}),e.addEventListener("touchend",e=>{const t=e.changedTouches[0].clientX-m,n=e.changedTouches[0].clientY-u;(c()?Math.abs(n)>60:Math.abs(t)>60)&&d((c()?n:t)>0?-1:1)},{passive:!0}),window.matchMedia("(max-width:767px)").matches&&(i.hidden=!0),addEventListener("resize",()=>o(s)),c()||(r(0),o(0))}(),function(){const e=document.querySelectorAll(".reveal");if(0===e.length)return;const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("visible")})},{root:null,rootMargin:"0px",threshold:.1});e.forEach(e=>t.observe(e))}(),function(){if(!document.getElementById("hero"))return;const e=[{image:"./assets/imgs/banner.jpg",title:"CÔNG THỦ TOÀN DIỆN",subtitle:"LỰA CHỌN LÝ TƯỞNG",paragraph:"Mạnh mẽ trong tấn công, chính xác trong kiểm soát. Hiệu suất vượt trội cho người chơi bán chuyên và chuyên nghiệp."}],t=document.querySelectorAll(".slice"),n=document.getElementById("content");function i(){const e=100*(window.innerWidth<=768?3:5)+"% 100%";t.forEach(t=>{t.style.backgroundSize=e})}i(),function(i){const c=e[i];t.forEach(e=>{e.style.backgroundImage=`url('${c.image}')`,e.classList.remove("active")}),n.classList.remove("show"),setTimeout(()=>{t.forEach(e=>{window.innerWidth<=768&&(e===t[3]||e===t[4])||e.classList.add("active")}),setTimeout(()=>{n.classList.add("show")},2100)},100)}(0),window.addEventListener("resize",i)}(),function(){const e=document.getElementById("product-section");if(!e)return;const t=[{id:0,title:"WAVEX - WHITE",image:"./assets/imgs/products/white.webp",background:"radial-gradient(circle at 50% 50%, #444444 0%, var(--brand-black) 75%)","title-color":"#FFFFFF"},{id:1,title:"WAVEX - RED",image:"./assets/imgs/products/red.webp",background:"radial-gradient(circle at 50% 50%, #7c1010 0%, var(--brand-black) 75%)","title-color":"#F61F1F"},{id:2,title:"WAVEX - LIGHT BLUE",image:"./assets/imgs/products/blue.webp",background:"radial-gradient(circle at 50% 50%, #3a6275 0%, var(--brand-black) 75%)","title-color":"#93CEE6"},{id:3,title:"WAVEX - GREEN",image:"./assets/imgs/products/green.webp",background:"radial-gradient(circle at 50% 50%, #02571f 0%, var(--brand-black) 75%)","title-color":"#04AA3D"},{id:4,title:"WAVEX - PINK",image:"./assets/imgs/products/pink.webp",background:"radial-gradient(circle at 50% 50%, #7a3a50 0%, var(--brand-black) 75%)","title-color":"#E37097"},{id:5,title:"WAVEX - ORANGE",image:"./assets/imgs/products/orange.webp",background:"radial-gradient(circle at 50% 50%, #834700 0%, var(--brand-black) 75%)","title-color":"#FF8A00"}];let n=0,i=!1;const c=document.getElementById("main-image"),a=document.getElementById("main-title");function s(i){const s=t[i];e.style.background=s.background,e.style.setProperty("--title-color",s["title-color"]),a.style.color=s["title-color"],c.src=s.image,c.alt=s.title,n=i}function o(){i=!0,c.classList.remove("animate-image-out"),a.classList.remove("animate-title-out"),c.classList.add("animate-image-in"),a.classList.add("animate-title-in"),Promise.all([new Promise(e=>c.addEventListener("animationend",e,{once:!0})),new Promise(e=>a.addEventListener("animationend",e,{once:!0}))]).then(()=>{i=!1})}function r(e){e===n||i||(i=!0,c.classList.remove("animate-image-in"),a.classList.remove("animate-title-in"),c.classList.add("animate-image-out"),a.classList.add("animate-title-out"),c.addEventListener("animationend",()=>{s(e),o()},{once:!0}))}document.querySelectorAll("#product-section .product-color-button").forEach(e=>{const t=parseInt(e.dataset.id,10);e.addEventListener("click",e=>{e.preventDefault(),r(t)})}),s(0),requestAnimationFrame(()=>{o()})}(),function(){const e=document.getElementById("expanding-gallery");if(!e)return;const t=document.createDocumentFragment();[{id:1,name:"WAVEX - RED",color:"RED",image:"./assets/imgs/products/red.webp",colorHEX:"#F61F1F"},{id:2,name:"WAVEX - LIGHT BLUE",color:"LIGHT BLUE",image:"./assets/imgs/products/blue.webp",colorHEX:"#93CEE6"},{id:3,name:"WAVEX - GREEN",color:"GREEN",image:"./assets/imgs/products/green.webp",colorHEX:"#04AA3D"},{id:4,name:"WAVEX - PINK",color:"PINK",image:"./assets/imgs/products/pink.webp",colorHEX:"#E37097"},{id:5,name:"WAVEX - ORANGE",color:"ORANGE",image:"./assets/imgs/products/orange.webp",colorHEX:"#FF8A00"},{id:6,name:"WAVEX - WHITE",color:"WHITE",image:"./assets/imgs/products/white.webp",colorHEX:"#FFFFFF"}].forEach(e=>{const n=document.createElement("div");n.className="gallery-panel",n.style.setProperty("--accent-color",e.colorHEX),n.innerHTML=`\n                <img class="gallery-panel-image" src="${e.image}" alt="${e.name}" />\n                <h1 class="gallery-panel-title">${e.color}</h1>\n            `,t.appendChild(n)}),e.innerHTML="",e.appendChild(t);const n=e.querySelectorAll(".gallery-panel"),i=window.innerWidth<=768;n.forEach(e=>{i?e.addEventListener("click",()=>{e.classList.contains("active")?e.classList.remove("active"):(n.forEach(e=>e.classList.remove("active")),e.classList.add("active"))}):e.addEventListener("mouseenter",()=>{n.forEach(e=>e.classList.remove("active")),e.classList.add("active")})}),i||e.addEventListener("mouseleave",()=>{n.forEach(e=>e.classList.remove("active"))})}(),function(){if(!document.getElementById("faq"))return;const e=[{id:0,number:"/01",question:"Vợt này phù hợp với người chơi nào?",answer:"Leopard Wave X là lựa chọn hoàn hảo cho người chơi Pickleball tìm kiếm một cây vợt công thủ toàn diện, lý tưởng cho cả người chơi bán chuyên lẫn chuyên nghiệp muốn nâng cao hiệu suất thi đấu. <br/> <ul><li><strong>Người mới chơi:</strong>: Dễ làm quen, kiểm soát tốt, học nhanh hơn</li><li><strong>Người chơi trung cấp:</strong>: Nâng cấp kỹ thuật, công thủ toàn diện</li><li><strong>Người chơi chuyên nghiệp:</strong>: Thi đấu cấp cao, ổn định, bền bỉ</li><li><strong>Người hay bị đau cổ tay:</strong>: Giảm rung, bảo vệ sức khỏe</li></ul>",image:"./assets/imgs/products/white.webp"},{id:1,number:"/02",question:"Ưu điểm của Lõi Gen 4 & Carbon Toray?",answer:"Mặt Carbon Toray 3 lớp siêu bền, bám bóng tốt. Lõi Gen 4 + EVA giúp giảm rung, tăng độ êm và mở rộng điểm ngọt (sweet spot), mang lại cảm giác đánh chắc tay và ổn định ngay cả ở tốc độ cao.",image:"./assets/imgs/products/red.webp"},{id:2,number:"/03",question:"Chip NFC để làm gì và sử dụng thế nào?",answer:"Chip NFC dùng để kiểm tra hàng chính hãng. Bạn chỉ cần bật NFC trên điện thoại thông minh và chạm vào vị trí có chip trên vợt, điện thoại sẽ tự động hiển thị thông tin xác thực sản phẩm.",image:"./assets/imgs/products/white.webp"}],t=document.getElementById("faq-display-wrapper"),n=document.getElementById("faq-display-number"),i=document.getElementById("faq-display-question"),c=document.getElementById("faq-display-answer"),a=document.querySelectorAll(".faq-list-button");function s(s){const o=e.find(e=>e.id==s);o&&t&&t.dataset.activeId!=s&&(t.classList.add("is-transitioning"),t.dataset.activeId=s,setTimeout(()=>{n&&(n.textContent=o.number),i&&(i.textContent=o.question),c&&(c.innerHTML=o.answer),t.classList.remove("is-transitioning")},300),a.forEach(e=>{e.classList.toggle("active",e.dataset.faqId==s)}))}a.forEach(t=>{const n=t.dataset.faqId,i=e.find(e=>e.id==n);if(i){const e=document.createElement("div");e.className="faq-mobile-answer",e.innerHTML=`<p>${i.answer}</p>`,t.insertAdjacentElement("afterend",e)}}),document.querySelectorAll(".faq-mobile-answer"),a.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.faqId;window.innerWidth<1024?function(e){const t=e.classList.contains("active");a.forEach(e=>{e.classList.remove("active")}),t||e.classList.add("active")}(e):s(t)})}),window.addEventListener("resize",()=>{if(window.innerWidth>=1024){a.forEach(e=>e.classList.remove("active"));s((t?t.dataset.activeId:"0")||"0")}else a.forEach(e=>e.classList.remove("active"))}),window.innerWidth>=1024&&s(0)}(),function(){const e=document.getElementById("loupe-container"),t=document.getElementById("loupe-image");if(!e||!t)return;if(window.innerWidth<=768){const n=document.getElementById("image-lightbox"),i=document.getElementById("lightbox-image"),c=document.getElementById("lightbox-close");if(!n||!i||!c)return;e.addEventListener("click",()=>{i.src=t.src,n.classList.add("visible"),n.classList.remove("hidden")}),c.addEventListener("click",()=>{n.classList.remove("visible"),n.classList.add("hidden")}),n.addEventListener("click",e=>{e.target===n&&(n.classList.remove("visible"),n.classList.add("hidden"))})}else{const n=document.createElement("div");n.id="loupe-glass",e.appendChild(n);const i=2.5;e.addEventListener("mouseenter",function(){const e=t.clientWidth,c=t.clientHeight;n.style.backgroundImage=`url(${t.src})`,n.style.backgroundSize=`${e*i}px ${c*i}px`,n.classList.add("visible")}),e.addEventListener("mouseleave",function(){n.classList.remove("visible")}),e.addEventListener("mousemove",function(c){const a=e.getBoundingClientRect(),s=c.clientX-a.left,o=c.clientY-a.top,r=n.offsetWidth,l=n.offsetHeight;n.style.left=s-r/2+"px",n.style.top=o-l/2+"px";const d=s/t.clientWidth,m=o/t.clientHeight,u=-(t.clientWidth*i*d-r/2),g=-(t.clientHeight*i*m-l/2);n.style.backgroundPosition=`${u}px ${g}px`})}}(),function(){const e=document.querySelectorAll("#order-form .product-color-button"),t=document.getElementById("form-selected-color"),n=document.getElementById("form-selected-color-name");e.length&&t&&n&&(e[0].classList.add("active"),e.forEach(i=>{i.addEventListener("click",c=>{c.preventDefault();const a=i.dataset.id,s=i.dataset.name;t.value=a,n.value=s,e.forEach(e=>e.classList.remove("active")),i.classList.add("active")})}))}(),function(){const e=document.querySelectorAll('#order-form input[name="selected_size"]'),t=document.querySelectorAll("#order-form .size-selector-label"),n=document.querySelectorAll("#order-form .hidden-16");e.length&&t.length&&e.forEach(e=>{e.addEventListener("change",()=>{"size-16mm"===e.id?n.forEach(e=>e.classList.add("hidden")):n.forEach(e=>e.classList.remove("hidden")),t.forEach(e=>e.classList.remove("active"));const i=document.querySelector(`label[for="${e.id}"]`);i&&i.classList.add("active")})})}(),function(){const e=document.getElementById("order-form-element"),t=document.getElementById("form-submit-button"),n=document.getElementById("form-message");e&&t&&n&&e.addEventListener("submit",async i=>{i.preventDefault(),t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i> Đang xử lý...',n.classList.add("hidden"),n.classList.remove("success","error");const c=new FormData(e),a=Object.fromEntries(c.entries());try{const t=await fetch("https://api.xuan.media/send_mail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(t.ok){n.textContent="Đặt hàng thành công! Chúng tôi sẽ liên hệ với bạn sớm nhất.",n.classList.add("success"),n.classList.remove("hidden"),e.reset(),document.getElementById("size-14mm").checked=!0,document.querySelector('label[for="size-14mm"]').classList.add("active"),document.querySelector('label[for="size-16mm"]').classList.remove("active"),document.querySelectorAll("#order-form .product-color-button").forEach((e,t)=>{e.classList.toggle("active",0===t)}),document.getElementById("form-selected-color").value="0",document.getElementById("form-selected-color-name").value="Purple",document.getElementById("quantity-1").checked=!0,document.querySelectorAll('#order-form label[for^="quantity-"]').forEach(e=>{e.classList.toggle("active","quantity-1"===e.htmlFor)});const t=new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(215e4).replace(/\s/g,"").replace("₫"," VNĐ"),i=new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(3e6).replace(/\s/g,"").replace("₫"," VNĐ");document.getElementById("dynamic-price").textContent=t,document.getElementById("original-price").textContent=i,document.getElementById("form-selected-gift").value="Không có"}else{const e=await t.json().catch(()=>({}));n.textContent=`Lỗi: ${e.message||"Không thể gửi đơn hàng. Vui lòng thử lại."}`,n.classList.add("error"),n.classList.remove("hidden")}}catch(e){console.error("Lỗi khi gửi form:",e),n.textContent="Lỗi kết nối. Vui lòng kiểm tra mạng và thử lại.",n.classList.add("error"),n.classList.remove("hidden")}finally{t.disabled=!1,t.innerHTML='<i class="fas fa-shopping-cart mr-2"></i> Đặt Hàng Ngay'}})}()});